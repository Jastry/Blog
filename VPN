
---
##### 虚拟专用网络 VPN
 
- 由于 IP 地址的紧张，一个机构能申请到的 IP 地址往往远小于本机构所拥有的主机数，考虑到英特网并不很安全，一个机构也并不需要把所有的主机连接到外部的因特网。但实际上，很多情况下，很多主机还是要和本机构内的其他主机 。

- 有时一个很大的机构有许多部门分布在相距很远的地方，而在每一个地点都有自己的专用网。假定分布在不同地点的专用网需要经常通信。这时，可以有两种方法。第一种方法就是租用电信公司专用的通信线路为本机构所专用，这种方法的好处是简单方便，但线路租金太高。第二种方法是利用共用的因特网作为本机构专用网络的载体，这样的专用网又称为<font color = #00ff00>虚拟专用网 VPN</font>。

- 之所以称之为专用网，是因为这种网络是为本机构的主机用于机构内部的通信，而不是用于和网络外非本机构的主机通信。如果专用网不同网点之间的通信必须经过共用的因特网，但又有保密的要求，那么所有经过因特网传送的数据都必须加密。“虚拟”表示好像是，但实际上并不是，因为现在并没有使用专线，而是通过因特网来链接分散在各场所的本地网络。VPN 只是在效果上和真正的专用网一样。一个机构要构建自己的 VPN 就必须为他的每一个场所购买专用的硬件和软件，并进行配置，使每一个场所的 VPN 系统都知道其他场所的地址。

---
#####IP 隧道技术实现虚拟专用网

假定某个机构再相聚很远的两个地方建立了专用网 A 和 B，其网络地址分别为专用网地址 10.1.0.0 和 10.2.0.0。现在这两个场所需要通过因特网构成一个 VPN。

显然，每一个场所至少有一个路由器具有合法的全球 IP 地址，如图中的路由器 R1 和 R2与专用网内部网络通信的接口地址则是专用网的本地地址

[picture]

在每一个内部网 A 或 B 内部的通信都不经过因特网。但如果场所 A 的主机 X 要和场所 B 的主机 Y 通信，那么就必须经过路由器 R1 和 R2。主机 X 向主机 Y 发送的 IP 数据报的源地址时 10.1.01，目的 IP 是 10.2.0.3。这个数据报先做为本机构内部数据报从 X 发送到连接英特网的路由器 R1，路由器 R1 收到内部数据报后，发现其目的网络必须要通过因特网才能到达，就把整个数据报进行加密（保证内部数据报的安全），然后重新加上数据报的首部，封装成因特网上发送的外部数据报，其源地址是路由器 R1 的全球地址 125.1.2.3，目的地址是 R2 的全球地址 125.4.5.6。路由器 R2 收到数据报后将其数据部分取出进行解密，恢复出原来内部数据报的样子，交付给主机 Y。可见虽然 X 向 Y 发送的数据报通过了因特网中很多个网络，但在效果上就好像在本地专用网络内部进行通信。如果主机 Y 向 X 通信 ，那么所经过的步骤也是类似的。

<font color = ff3333>注意</font>，数据从 R1 发送到 R2，需要经过因特网中很多的网络，但从逻辑上看，在 R1 到 R2 间好像是一条直通的点对点链路，“隧道”就是这个意思。

由 A 和 B 的内部专用网所构成的虚拟专用网 VPN 又称为内联网（intranet），表示场所 A 和 B 都属于同一机构。
有时一个机构的 VPN 需要某些外部机构（通常是合作伙伴）参加进来。这样的 VPN 称为外联网（extranet VPN）。
内联网和外联网都用了因特网技术，即都是基于 TCP/IP 协议的。
还有一种 VPN，就是远程接入 VPN（remote access VPN）。我们知道，有的公司可能并没有分布在不通常所的部门，但却有很多员工流动在外地工作。公司需要和他们保持联系，有时需要开电话会议。远程接入 VPN 可以满足这种需求。在外地工作的员工通过拨号接入因特网，而驻留在员工 PC 机上的 VPN 软件就可以在员工 PC 机和公司的主机之间建立 VPN 隧道，因而外部员工与公司内部通信的内容是保密的，员工们就好像用了内部网络。